{% extends \"admin/admin_base.html\" %}

{% block title %}{{ form_title }} - Admin{% endblock %}

{% block head_extra %}
<style>
    .photo-preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    .photo-preview {
        position: relative;
        border: 1px solid #ddd;
        padding: 5px;
        border-radius: 4px;
    }
    .photo-preview img {
        max-width: 100px;
        max-height: 100px;
        display: block;
    }
    .photo-preview .delete-photo-btn {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: rgba(220, 53, 69, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        line-height: 18px;
        text-align: center;
        cursor: pointer;
        padding: 0;
    }
</style>
{% endblock %}

{% block admin_content %}
    <h2>{{ form_title }}</h2>

    <form method="POST" action="{{ form_action }}" enctype="multipart/form-data">
        <div class="form-group">
            <label for="brand">Marca *</label>
            <input type="text" id="brand" name="brand" class="form-control" value="{{ vehicle.brand if vehicle else request.form.brand }}" required>
        </div>
        <div class="form-group">
            <label for="model">Modelo *</label>
            <input type="text" id="model" name="model" class="form-control" value="{{ vehicle.model if vehicle else request.form.model }}" required>
        </div>
        <div class="form-group">
            <label for="year">Ano *</label>
            <input type="number" id="year" name="year" class="form-control" value="{{ vehicle.year if vehicle else request.form.year }}" required min="1900" max="{{ current_year + 1 }}"> {# Adjust max year as needed #}
        </div>
        <div class="form-group">
            <label for="mileage">Quilometragem *</label>
            <input type="number" id="mileage" name="mileage" class="form-control" value="{{ vehicle.mileage if vehicle else request.form.mileage }}" required min="0">
        </div>
        <div class="form-group">
            <label for="color">Cor *</label>
            <input type="text" id="color" name="color" class="form-control" value="{{ vehicle.color if vehicle else request.form.color }}" required>
        </div>
        <div class="form-group">
            <label for="price">Preço (R$) *</label>
            <input type="number" step="0.01" id="price" name="price" class="form-control" value="{{ vehicle.price if vehicle else request.form.price }}" required min="0">
        </div>
        <div class="form-group">
            <label for="description">Descrição / Métodos de Pagamento</label>
            <textarea id="description" name="description" class="form-control" rows="5">{{ vehicle.description if vehicle else request.form.description }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="photos">Fotos (Selecione uma ou mais)</label>
            <input type="file" id="photos" name="photos" class="form-control-file" multiple accept="image/*">
        </div>

        {% if vehicle and vehicle.photos %}
            <div class="form-group">
                <label>Fotos Atuais:</label>
                <div class="photo-preview-container">
                    {% for photo in vehicle.photos %}
                        <div class="photo-preview">
                            <img src="{{ url_for(\'uploaded_files\', filename=photo.filename) }}" alt="Foto {{ photo.id }}">
                            <form action="{{ url_for(\'admin_bp.delete_vehicle_photo\', photo_id=photo.id) }}" method="POST" style="display: inline;" onsubmit="return confirm(\'Tem certeza que deseja excluir esta foto?\");">
                                <button type="submit" class="delete-photo-btn" title="Excluir Foto">&times;</button>
                            </form>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        <button type="submit" class="btn btn-primary">Salvar Veículo</button>
        <a href="{{ url_for(\'admin_bp.manage_vehicles\') }}" class="btn btn-secondary">Cancelar</a>
    </form>
{% endblock %}
